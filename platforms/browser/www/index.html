<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <!-- This is a wide open CSP declaration. To lock this down for production, see below. -->
   <!-- <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src *" />-->
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: 'unsafe-inlin e' https://ssl.gstatic.com; style-src 'self' 'unsafe-inline'; media-src *" /> -->
    <link rel="stylesheet" type="text/css" href="css/index.css"/>
    <!-- Path to your custom app styles-->
    <link rel="stylesheet" href="bower_components/framework7/dist/css/my-app.css">

    <link rel="stylesheet" href="bower_components/framework7-icons/css/framework7-icons.css">

    <link rel="stylesheet" href="bower_components/framework7/dist/css/framework7.material.colors.min.css">

    <link rel="stylesheet" href="bower_components/framework7/dist/css/framework7.ios.min.css">
    <!-- Path to Framework7 iOS related color styles -->
    <link rel="stylesheet" href="bower_components/framework7/dist/css/framework7.ios.colors.min.css">

    <link rel="stylesheet" type="text/css" href="css/xeno.css"/>
    <title></title>
</head>

<body class="layout-gray">
<!-- Status bar overlay for full screen mode (PhoneGap) -->
<div class="statusbar-overlay"></div>
<!-- Panels overlay-->
<div class="panel-overlay"></div>
<!-- Left panel with reveal effect-->
<div class="panel panel-left panel-reveal xenofont">
    <div class="list-block">
        <ul>
            <li class="item-content animation close-panel" data-force="true" onClick="mainView.router.loadPage('index.html');">
                <div class="item-media"><i class="f7-icons size-18">data</i></div>
                <div class="item-inner">
                    <div class="item-title"> ACCUEIL </div>
                </div>
            </li>
            <li class="item-content animation close-panel" data-force="true" onClick="mainView.router.loadPage('mesjeux.html');" >
                <div class="item-media"><i class="f7-icons size-18">star</i></div>
                <div class="item-inner">
                    <div class="item-title"> jeux </div>
                </div>
            </li>
            <li class="item-content animation close-panel" data-force="true" onClick="mainView.router.loadPage('listechats.html');">
                <div class="item-media"><i class="f7-icons size-18">chats</i></div>
                <div class="item-inner">
                    <div class="item-title"> Chat </div>
                </div>
            </li>
            <li class="item-content animation close-panel" data-force="true" onClick="mainView.router.loadPage('evenements.html');">
                <div class="item-media"><i class="f7-icons size-18">calendar</i></div>
                <div class="item-inner">
                    <div class="item-title"> Évènements </div>
                </div>
            </li>
            <li class="item-content animation close-panel" data-force="true" onClick="mainView.router.loadPage('news.html');">
                <div class="item-media"><i class="f7-icons size-18">world</i></div>
                <div class="item-inner">
                    <div class="item-title"> Nouveautés </div>
                </div>
            </li>
            <li class="item-content animation close-panel" data-force="true"  onClick="mainView.router.loadPage('profil.html');">
                <div class="item-media"><i class="f7-icons size-18">person</i></div>
                <div class="item-inner">
                    <div class="item-title"> Profil </div>
                </div>
            </li>
            <li class="item-content animation close-panel" data-force="true" onClick="mainView.router.loadPage('contacts.html');">
                <div class="item-media"><i class="f7-icons size-18">phone</i></div>
                <div class="item-inner">
                    <div class="item-title"> Contact </div>
                </div>
            </li>
        </ul>
    </div>
</div>
<div data-page="login-screen" class="page no-navbar no-toolbar no-swipeback login-screen xenofont modal-in layout-dark">
    <div class="page-content login-screen-content layout-dark">
        <div class="login-screen-title">
            <img id="xenologo" src="img/xenomorphe_logo_white_LD.png"/></div>
        <form>
            <p class="buttons-row ">
                <a href="#" onclick="login('google')"
                   class="button button-big button-fill color-red"><i class="f7-icons size-22">social_googleplus</i>
                    Google</a>
            </p>
            <p class="buttons-row ">
                <a href="#" onclick="login('facebook')"
                   class="button button-big button-fill color-blue "><i class="f7-icons size-22">social_facebook</i>
                    Facebook</a>
            </p>
            <div class="list-block-label" style="padding : 0px; margin-top : -7px; margin-bottom : -20px;">
                <p>ou</p>
            </div>
            <div class="list-block">
                <ul>
                    <li class="item-content">
                        <div class="item-inner">
                            <div class="item-input">
                                <input type="text" name="username" id="login_native" placeholder="Login" style="text-align: center;" />
                            </div>
                        </div>
                    </li>
                    <li class="item-content">
                        <div class="item-inner">
                            <div class="item-input">
                                <input type="password" name="password" id="password_native" placeholder="Mot de passe" style="text-align: center;" />
                            </div>
                        </div>
                    </li>
                        <p class="buttons-row">
                            <a href="#" data-popup=".popup-inscription" class="button button-big color-white open-popup" style="border : none; margin-top: -10px;">Inscription</a>
                            <a href="#" onclick="connexionNative();" class="button button-big color-white" style="border : none; margin-top: -10px;">Connexion</a>
                        </p>
                </ul>
            </div>
          <!--  <div class="list-block-label">
                <p>Veuillez vous connecter pour accéder aux contenus de l'application.</p>
            </div>-->
        </form>
    </div>
</div>
<!-- popup inscription -->
<div class="popup popup-inscription tablet-fullscreen xenofont">
    <div class="content-block">
        <div class="list-block no-border">
            <h2 style="text-align: center;" >Inscription</h2>
            <ul>
                <li class="item-content">
                    <div class="item-media"><i class="icon f7-icons">person</i></div>
                    <div class="item-inner">
                        <div class="item-input">
                            <input type="text" id="login_inscription" name="username" placeholder="Login" style="text-align: center; " />
                        </div>
                    </div>
                </li>
                <li class="item-content ">
                    <div class="item-media"><i class="icon f7-icons">lock</i></div>
                    <div class="item-inner">
                        <div class="item-input">
                            <input type="password" id="password_inscription" name="password" placeholder="Mot de passe" style="text-align: center;" />
                        </div>
                    </div>
                </li>
                <li class="item-content ">
                    <div class="item-media"><i class="icon f7-icons">lock</i></div>
                    <div class="item-inner">
                        <div class="item-input">
                            <input type="password" id="password_repeat_inscription" name="password" placeholder="Répéter le mot de passe" style="text-align: center;" />
                        </div>
                    </div>
                </li>
                <li class="item-content">
                        <div class="item-media"><i class="icon f7-icons">email</i></div>
                        <div class="item-inner">
                            <div class="item-input ">
                                <input type="email" id="email_inscription" placeholder="E-mail (Optionel)"  style="text-align: center;">
                            </div>
                        </div>
                </li>
            </ul>
            <p><a href="#" class="button" onclick="inscriptionNative();">S'incrire</a></p>
            <p style="text-align: center;" ><a href="#" class="close-popup center">Fermer la fenêtre d'inscription</a></p>
        </div>
    </div>
</div>
<!-- Views -->
<div class="views xenofont">
    <!-- Your main view, should have "view-main" class -->
    <div class="view view-main">
        <!-- Top Navbar-->
        <div class="navbar">
            <div class="navbar-inner">
                <div class="left">
                    <a href="#" class="link icon-only" onclick="mainView.router.back();">
                        <i class="icon icon-back"></i>
                    </a>
                </div>
                <div class="center sliding">
                    Xenomorphe App
                </div>
                <div class="right">
                    <a href="#" class="link icon-only open-panel"><i class="icon icon-bars"></i></a>
                </div>
            </div>
        </div>
        <!-- Pages container, because we use fixed-through navbar and toolbar, it has additional appropriate classes-->
        <div class="pages navbar-through toolbar-through">
            <!-- Page, "data-page" contains page name -->
            <div data-page="index" class="page">
                <!-- Scrollable page content -->
                <div class="page-content">
                    <div class="card">
                        <div class="card-header col-50">Bienvenue !</div>

                        <div class="card-content">
                            <div class="list-block media-list">
                                <ul>
                                    <li class="item-content">
                                        <div class="item-media">
                                           <img id="imgUser" src="" width="44"/>
                                        </div>
                                        <div class="item-inner">
                                            <div class="item-title-row">
                                                <div id="nameUser" class="item-title"></div>
                                                <div class="item-after" onClick="logout();">Logout</div>
                                            </div>
                                            <div id="viaUser" class="item-subtitle"></div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div id="pageIndex" class="list-block inset">
                        <ul>
                            <li>
                                <span class="buttons-row"> 
                                    <a  onClick="mainView.router.loadPage('listechats.html');" href="#" style="height : 80px;padding-top: 20px;background-color:rgb(116,5,9);" data-force="true" class="button button-raised button-fill "><i class="f7-icons size-15">chats</i> Chat</a>
                                    <a onClick="mainView.router.loadPage('evenements.html');" href="#" style="height : 80px;padding-top: 20px;background-color:rgb(116,5,9);" data-force="true" class="button button-raised button-fill "><i class="f7-icons size-15">calendar</i> évènements</a>
                                </span>
                            </li>
                            <li>
                                <span class="buttons-row">
                                    <a onClick="mainView.router.loadPage('news.html');"  href="#" style="height : 80px;padding-top: 20px;background-color:rgb(116,5,9);" data-force="true" class="button button-raised button-fill "><i class="f7-icons size-15">world</i> Nouveautés</a>
                                		<a onClick="mainView.router.loadPage('mesjeux.html');" data-force="true" href="#" style="height : 80px;padding-top: 20px;background-color:rgb(116,5,9);" class="button button-raised button-fill "><i class="f7-icons size-15">star</i> jeux </a>
                                </span>
                            </li>
                            <li>
                                <span class="buttons-row">
                                    <a onClick="mainView.router.loadPage('profil.html');" href="#" style="height : 80px;padding-top: 20px;background-color:rgb(116,5,9);" data-force="true" class="button button-raised button-fill "><i class="f7-icons size-15">person</i> Profil </a>
                                    <a onClick="mainView.router.loadPage('contacts.html');" href="#" style="height : 80px;padding-top: 20px;background-color:rgb(116,5,9);" data-force="true" class="button button-raised button-fill "><i class="f7-icons size-15">info</i> Contacts</a>
                                </span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript" src="js/index.js"></script>
<script type="text/javascript" src="bower_components/hello/dist/hello.all.js"></script>
<script type="text/javascript" src="bower_components/framework7/dist/js/framework7.min.js"></script>
<script type="text/javascript" src="bower_components/framework7/dist/js/my-app.js"></script>
<script type="text/javascript" src="bower_components/jquery/dist/jquery.js"></script>

<script type="text/javascript">
    app.initialize();
    var mainView;
    var user = "";
    var apiHost = "http://adrien.dallinge.ch/cave/wp-json";
    var myApp = new Framework7({
        swipePanel: 'left',

    });

    var $$ = Dom7;
    mainView = myApp.addView('.view-main', {
         dynamicNavbar: true
     });

    hello.init({
        google: '656984324806-sr0q9vq78tlna4hvhlmcgp2bs2ut8uj8.apps.googleusercontent.com',
        facebook: '198728560590653'
    }, {
        redirect_uri: 'https://adodson.com/hello.js/redirect.html'
    });

    if (localStorage.getItem('login_native') != 'undefined' && localStorage.getItem('password_native') != 'undefined'){
        $("#login_native").val(localStorage.getItem('login_native'));
        $("#password_native").val(localStorage.getItem('password_native'));
    }

    if (localStorage.getItem('user') != 'undefined' ) {
        user = JSON.parse(localStorage.getItem('user'));
        initIndexPage ()
        myApp.closeModal('.login-screen');
    }

    function logout() {
        user = "";
        localStorage.removeItem('user');
        hello(user.connexion).logout().then(function() {
            alert('Signed out');
        }, function(e) {
            alert('Signed out');
        });
        myApp.loginScreen();
    }

    function login(network) {
        var hi = hello(network);
        hi.login().then(function (r) {
                return hi.api('me').then(function (json) {
                    user = json;
                    user.connexion = network;
                    $.post("http://adrien.dallinge.ch/cave/wp-json/xeno/users", { facebookId: (user.connexion == 'facebook') ? user.id : "", googleId:  ((user.connexion == 'google')  ? user.id  : ""), name :  user.name, thumbnail : user.thumbnail },
                        function(reponse) {
                            user.token = reponse;
                            localStorage.setItem('user',JSON.stringify(user));
                            initIndexPage();
                            myApp.closeModal('.login-screen');
                    })
                }, function (e) {
                    alert('Whoops! ' + e.error.message);
                });
            })
    }

    myApp.onPageInit('index', function (page) {
        initIndexPage ();
    });


    $$(document).on('page:init', function (e) {
        initIndexPage ();
    });

    myApp.onPageBack('index', function(page) {
        initIndexPage ();
    });

    function setHeader(xhr){
        xhr.setRequestHeader('Authorization',user.token);
    }

    function initIndexPage () {
        $.ajax({
            url: 'http://adrien.dallinge.ch/cave/wp-json/xeno/users/me',
            type: 'GET',
            dataType: 'json',
            beforeSend: setHeader
        }).done(function( data ) {
            user.name = data.name;
            user.thumbnail = data.thumbnail;
            user.connexion = data.connexion;
            user.id = data.id_user;
            $("#nameUser").html(user.name);
            $("#imgUser").prop('src', user.thumbnail);
            $("#viaUser").html("via " + user.connexion);
        });
    }

    /*********************************************** INSCRIPTION ET CONNEXION NATIVE ****************************************/
    function inscriptionNative() {
        var login_inscription = $("#login_inscription").val();
        var password_inscription = $("#password_inscription").val();
        var password_repeat_inscription = $("#password_repeat_inscription").val();
        var email_inscription = $("#email_inscription").val();

        if(password_inscription == password_repeat_inscription) {
            $.post("http://adrien.dallinge.ch/cave/wp-json/xeno/users/native",
                {
                    login: login_inscription,
                    password : login_inscription,
                    email :  email_inscription
                },
                function (reponse) {
                    myApp.alert("",'Inscription terminée avec succès');
                    $("#login_native").val(login_inscription);
                    $("#password_native").val(password_inscription);
                    myApp.closeModal('.popup-inscription');
                }).fail(function() {
                    alert( "error" );
                })
        }else {
            alert('password incorrect');
        }
    }

    function connexionNative() {
        var login_native = $("#login_native").val();
        var password_native = $("#password_native").val();
        if(login_native.length > 0 && password_native.length > 0) {
            $.post("http://adrien.dallinge.ch/cave/wp-json/jwt-auth/v1/token", {username : login_native, password : password_native}, function(reponse){
                user.token = reponse;
                localStorage.setItem('user',JSON.stringify(user));
                localStorage.setItem('login_native',login_native);
                localStorage.setItem('password_native',password_native);
                initIndexPage();
                myApp.closeModal('.login-screen');
            }).fail(function() {
                alert( "error" );
            });
        }
    }



</script>
<script src="js/fonctions.js" type="text/javascript"></script>
<script src="js/mesjeux.js" type="text/javascript"></script>
<script src="js/evenements.js" type="text/javascript"></script>
<script src="js/news.js" type="text/javascript"></script>
<script src="js/profil.js" type="text/javascript"></script>
<script src="js/chats.js" type="text/javascript"></script>
</body>

</html>